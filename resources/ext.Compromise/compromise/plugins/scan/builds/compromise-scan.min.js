!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(t=t||self).compromiseScan=n()}(this,(function(){"use strict";var t=function(t){var n,e=[],o=(n=t)&&"[object Object]"===Object.prototype.toString.call(n);!0===o&&(t=Object.keys(t).map((function(n){return e.push(t[n]),n})));var r={0:{}},i={},u=0;t.forEach((function(t,n){var o=!0;void 0!==e[n]&&(o=e[n]);for(var a=0,c=t.split(/ /g),f=0;f<c.length;f++){var l=c[f];r[a]&&l in r[a]?a=r[a][l]:(u++,r[a][l]=u,r[u]={},a=u,i[u]=[])}i[a]=[{len:c.length,value:o}]}));var a={},c=[];for(var f in r[0])a[u=r[0][f]]=0,c.push(u);for(;c.length;){var l=c.shift();for(var s in r[l]){var v=r[l][s];for(c.push(v),u=a[l];u>0&&!(s in r[u]);)u=a[u];if(s in r[u]){var h=r[u][s];a[v]=h,i[v]=i[v].concat(i[h])}else a[v]=0}}return{isObj:o,gotoFn:r,output:i,failure:a}},n=function(t,n){for(var e=0,o=[],r=0;r<t.length;r++){var i=t[r].reduced;for(void 0===n.gotoFn[e]&&(n.gotoFn[e]=[]);e>0&&!(i in n.gotoFn[e]);)e=n.failure[e];if(i in n.gotoFn[e]&&(e=n.gotoFn[e][i],void 0!==n.output[e]))for(var u=n.output[e],a=0;a<u.length;a++){var c=u[a],f=t[r-c.len+1];o.push({id:f.id,len:c.len,value:c.value})}}return o},e=function(t,e){for(var o=[],r=0;r<t.list.length;r++){var i=t.list[r].terms()||[],u=n(i,e);u.length>0&&(o=o.concat(u))}var a={},c=t.list[0];return o.forEach((function(t){a[t.value]=a[t.value]||[],a[t.value].push(c.buildFrom(t.id,t.len))})),Object.keys(a).forEach((function(n){a[n]=t.buildFrom(a[n])})),!0===e.isObj?a:a[!0]||[]};return function(n,o,r){return r.buildTrie=function(n){return t(n)},n.prototype.scan=function(t){return this._cache&&!0===this._cache.set||this.cache(),e(this,t)},n}}));
