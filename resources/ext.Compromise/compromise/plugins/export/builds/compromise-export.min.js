!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):(t=t||self).compromiseExport=r()}(this,(function(){"use strict";var t=function(t){var r=Object.keys(t).filter((function(r){return t[r]>=2}));return(r=r.sort((function(r,n){return t[r]>t[n]?-1:t[r]<t[n]?1:0}))).reduce((function(t,r,n){return t[r]=n,t}),{})},r=function(t,r){var n=r.tags,e=[];return t.forEach((function(t){n[t]&&n[t].isA&&(e=e.concat(n[t].isA))})),e=e.reduce((function(t,r){return t[r]=!0,t}),{}),t=t.filter((function(t){return!e[t]}))},n=function(t){var r={};t.forEach((function(t){r[t]=r[t]||0,r[t]+=1}));var n=Object.keys(r);return(n=n.sort((function(t,n){return r[t]>r[n]?-1:1}))).map((function(t){return[t,r[t]]}))},e=function(){var e=this,o=this.json({text:!1,trim:!1,terms:{tags:!0,whitespace:!0}}),u=[],i={};o=o.map((function(t){return t.terms.map((function(t){return i[t.text]=i[t.text]||0,i[t.text]+=1,i[t.pre]=i[t.pre]||0,i[t.pre]+=1,i[t.post]=i[t.post]||0,i[t.post]+=1,t.tags=r(t.tags,e.world),u=u.concat(t.tags),[t.pre,t.text,t.post,t.tags]}))})),u=n(u);var f={};u.forEach((function(t,r){f[t[0]]=r}));var c=t(i);o.forEach((function(t){t.forEach((function(t){t[3]=t[3].map((function(t){return f[t]})).join(","),t[0]=void 0!==c[t[0]]?c[t[0]]:t[0],t[1]=void 0!==c[t[1]]?c[t[1]]:t[1],t[2]=void 0!==c[t[2]]?c[t[2]]:t[2]}))}));var s=[];return Object.keys(c).forEach((function(t){s[c[t]]=t})),{tags:Object.keys(f),words:s,list:o}},o=function(t){return"string"==typeof t&&(t=JSON.parse(t)),t.list.map((function(r){return{terms:r.map((function(r){var n=r[3].split(",").map((function(r){return t.tags[r]}));return{pre:"number"==typeof r[0]?t.words[r[0]]:r[0],text:"number"==typeof r[1]?t.words[r[1]]:r[1],post:"number"==typeof r[2]?t.words[r[2]]:r[2],tags:n.filter((function(t){return t}))}}))}}))};return function(t,r,n){t.prototype.export=e,n.import=function(t){var r=o(t,this.world);return n.fromJSON(r)}}}));
